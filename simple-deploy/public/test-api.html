<!DOCTYPE html>
<html>
  <head>
    <title>API Connection Test</title>
    <style>
      body {
        font-family: monospace;
        padding: 20px;
        background: #0a0c10;
        color: #e6edf3;
      }
      .test {
        margin: 10px 0;
        padding: 10px;
        border: 1px solid #333;
      }
      .success {
        border-color: #00e0b8;
      }
      .error {
        border-color: #ff3b3b;
      }
      pre {
        background: #121728;
        padding: 10px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>üîç API Connection Test</h1>
    <div id="results"></div>

    <script>
      const results = document.getElementById("results");

      function addResult(title, content, isSuccess = true) {
        const div = document.createElement("div");
        div.className = `test ${isSuccess ? "success" : "error"}`;
        div.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
        results.appendChild(div);
      }

      // Test 1: Environment Detection
      const isProduction = window.location.hostname.includes("vercel.app");
      const apiBase = isProduction
        ? "https://website-project-ai-production.up.railway.app"
        : window.location.origin;

      addResult(
        "üåç Environment Detection",
        `Hostname: ${window.location.hostname}\nIs Production: ${isProduction}\nAPI Base: ${apiBase}`
      );

      // Test 2: Health Check
      fetch(`${apiBase}/health`)
        .then((r) => r.json())
        .then((data) => {
          addResult("‚úÖ Health Check", JSON.stringify(data, null, 2));
        })
        .catch((error) => {
          addResult("‚ùå Health Check Failed", error.message, false);
        });

      // Test 3: Global News API
      fetch(`${apiBase}/api/global-news`)
        .then(async (response) => {
          const data = await response.json();
          addResult(
            "üì∞ Global News API",
            `Status: ${response.status}\nTotal Articles: ${
              data.totalArticles
            }\nCountries: ${Object.keys(data.countries || {}).join(
              ", "
            )}\nGlobal Articles: ${data.global?.length || 0}`
          );
        })
        .catch((error) => {
          addResult("‚ùå Global News API Failed", error.message, false);
        });

      // Test 4: CORS Headers
      fetch(`${apiBase}/api/global-news`)
        .then((response) => {
          const corsHeaders = {
            "Access-Control-Allow-Origin": response.headers.get(
              "Access-Control-Allow-Origin"
            ),
            "Access-Control-Allow-Credentials": response.headers.get(
              "Access-Control-Allow-Credentials"
            ),
            "Access-Control-Allow-Methods": response.headers.get(
              "Access-Control-Allow-Methods"
            ),
          };
          addResult("üîí CORS Headers", JSON.stringify(corsHeaders, null, 2));
        })
        .catch((error) => {
          addResult("‚ùå CORS Check Failed", error.message, false);
        });
    </script>
  </body>
</html>
